function createSystem(){for(var e=0;e<planetesArray.length;e++){var t=new Planete(planetesArray[e],e);planetes.push(t),t.load()}}function init(){scene=new THREE.Scene,scene.fog=new THREE.Fog(0,3500,15e3),scene.fog.color.setHSL(.51,.4,.01),renderer=new THREE.WebGLRenderer({alpha:!0,antialias:!0}),renderer.setSize(WIDTH,HEIGHT),container.appendChild(renderer.domElement),camera=new THREE.PerspectiveCamera(45,WIDTH/HEIGHT,1,1e4),camera.position.y=50,camera.position.z=4e3,scene.add(camera);var e=new THREE.AmbientLight(16777215);e.color.setHSL(.56,.53,.19),scene.add(e);var t=new THREE.DirectionalLight(16777215,.125);t.position.set(0,-1,0).normalize(),scene.add(t),t.color.setHSL(.56,.53,.29),textureFlare0=THREE.ImageUtils.loadTexture("../textures/lensflare0_alpha.png"),textureFlare2=THREE.ImageUtils.loadTexture("../textures/lensflare2.png"),textureFlare3=THREE.ImageUtils.loadTexture("../textures/lensflare3.png"),addLight(.55,.9,.5,5e3,0,-0),addLight(.08,.8,.5,0,0,-0),addLight(.995,.5,.9,5e3,0,-0);var n=new THREE.PointLight(16777215,1,100);n.position.set(6,6,6),scene.add(n),hemiLight=new THREE.HemisphereLight(16777215,16777215,.6),hemiLight.color.setHSL(.6,1,.6),hemiLight.groundColor.setHSL(.095,1,.75),hemiLight.position.set(0,100,40),scene.add(hemiLight),t=new THREE.DirectionalLight(16777215,1),t.color.setHSL(.1,1,.95),t.position.set(-1,1.75,1),t.position.multiplyScalar(50),scene.add(t),t.castShadow=!0,t.shadowMapWidth=2048,t.shadowMapHeight=2048;var a=50;for(t.shadowCameraLeft=-a,t.shadowCameraRight=a,t.shadowCameraTop=a,t.shadowCameraBottom=-a,t.shadowCameraFar=3500,t.shadowBias=-1e-4,t.shadowDarkness=.35,t.shadowCameraVisible=!0,loader.options.convertUpAxis=!0,createSystem(),center=scene.position,controls=new THREE.OrbitControls(camera,renderer.domElement),controls.movementSpeed=500,controls.domElement=container,controls.rollSpeed=.09,controls.autoForward=!1,controls.dragToLook=!0,controls.maxDistance=5e3,controls.minDistance=100,renderer.setClearColor(scene.fog.color,1),renderer.gammaInput=!0,renderer.gammaOutput=!0,window.addEventListener("resize",function(){renderer.setSize(WIDTH,HEIGHT),camera.aspect=WIDTH/HEIGHT,camera.updateProjectionMatrix()}),renderer.domElement.addEventListener("mousemove",onDocumentMouseMove,!1),renderer.domElement.addEventListener("mousedown",onDocumentMouseDown,!1),geometry=new THREE.Geometry,i=0;mount>i;i++){var o=new THREE.Vector3;o.x=4e3*Math.random()-3e3,o.y=4e3*Math.random()-3e3,o.z=4e3*Math.random()-3e3,geometry.vertices.push(o)}for(parameters=[[[1,1,.5],7],[[.95,1,.5],6],[[.9,.3,.5],5],[[.85,.3,.5],4],[[.8,.3,.5],3]],sprite=THREE.ImageUtils.loadTexture("textures/ball.png"),i=0;i<parameters.length;i++)size=parameters[i][1],materials[i]=new THREE.PointCloudMaterial({size:size,map:sprite,transparent:!0}),particules=new THREE.PointCloud(geometry,materials[i]),particules.rotation.x=6*Math.random(),particules.rotation.y=6*Math.random(),particules.rotation.z=6*Math.random(),scene.add(particules)}function addLight(e,t,n,a,o,r){var s=new THREE.PointLight(16777215,1.5,4500);s.color.setHSL(e,t,n),s.position.set(a,o,r),scene.add(s);var i=new THREE.Color(16777215);i.setHSL(e,t,n+.5);var l=new THREE.LensFlare(textureFlare0,700,0,THREE.AdditiveBlending,i);l.add(textureFlare2,512,0,THREE.AdditiveBlending),l.add(textureFlare2,512,0,THREE.AdditiveBlending),l.add(textureFlare2,512,0,THREE.AdditiveBlending),l.add(textureFlare3,60,.6,THREE.AdditiveBlending),l.add(textureFlare3,70,.7,THREE.AdditiveBlending),l.add(textureFlare3,120,.9,THREE.AdditiveBlending),l.add(textureFlare3,70,1,THREE.AdditiveBlending),l.customUpdateCallback=lensFlareUpdateCallback,l.position.copy(s.position),scene.add(l)}function lensFlareUpdateCallback(e){var t,n,a=e.lensFlares.length,o=2*-e.positionScreen.x,r=2*-e.positionScreen.y;for(t=0;a>t;t++)n=e.lensFlares[t],n.x=e.positionScreen.x+o*n.distance,n.y=e.positionScreen.y+r*n.distance,n.rotation=0;e.lensFlares[2].y+=.025,e.lensFlares[3].rotation=.5*e.positionScreen.x+THREE.Math.degToRad(45)}function animate(){requestAnimationFrame(animate),TWEEN.update(),render()}function render(){if(loaded){if(statutRot)for(var e=Date.now(),t=0;t<planetes.length;t++)planetes[t].mesh.position.x=Math.cos(e*planetes[t].speed*planetes[t].sens)*planetes[t].amp,planetes[t].mesh.position.z=Math.sin(e*planetes[t].speed*planetes[t].sens)*planetes[t].amp,planetes[t].mesh.rotation.y;for(var t=0;t<planetes.length;t++)planetes[t].mesh.rotation.y+=.01}var n=clock.getDelta();controls.update(n),statutRot||camera.lookAt(center),renderer.render(scene,camera)}function replaceCamera(e,t,n){new TWEEN.Tween(camera.position).to({x:e,y:t,z:n},1e3*Math.random()+1e3).easing(TWEEN.Easing.Exponential.InOut).start(),new TWEEN.Tween(camera.rotation).to({x:0,y:0,z:0},1e3*Math.random()+1e3).easing(TWEEN.Easing.Exponential.InOut).start(),new TWEEN.Tween(this).to({},2e3).onUpdate(render).start()}function zoomOnPlanet(e,t){center=planetes[e].mesh.position,pas=planetes[e].size+t,x=planetes[e].mesh.position.x+pas,y=planetes[e].mesh.position.y+pas,z=planetes[e].mesh.position.z+pas,$("#close").css("display","block"),$(".face").css("display","none"),replaceCamera(x,y,z),statutRot=!1,controls.enabled=!1}function onDocumentMouseMove(e){e.preventDefault(),mouse.x=e.clientX/window.innerWidth*2-1,mouse.y=2*-(e.clientY/window.innerHeight)+1;var t=new THREE.Vector3(mouse.x,mouse.y,.5);t.unproject(camera);for(var n=new THREE.Raycaster(camera.position,t.sub(camera.position).normalize()),a=[],o=0;o<planetes.length;o++)a.push(planetes[o].mesh);var r=n.intersectObjects(a,!0);if(r.length>0){r[0].object.parent.parent.instance.name}}function onDocumentMouseDown(e){e.preventDefault();var t=new THREE.Vector3(mouse.x,mouse.y,.5);t.unproject(camera);for(var n=new THREE.Raycaster(camera.position,t.sub(camera.position).normalize()),a=[],o=0;o<planetes.length;o++)a.push(planetes[o].mesh);var r=n.intersectObjects(a,!0);if(r.length>0){console.log(r[0].object.parent.parent.instance.index);var s=r[0].object.parent.parent.instance.index;zoomOnPlanet(s,130)}}var scene,camera,renderer,bouton,index,center,textureFlare0,textureFlare1,textureFlare3,particles,geometry,materials=[],parameters,i,h,color,planetes=[],mouse=new THREE.Vector2,statutRot=!0,WIDTH=window.innerWidth,HEIGHT=window.innerHeight,container=document.getElementById("container"),clock=new THREE.Clock,loader=new THREE.ColladaLoader,mount=1e3,loaded=!1,Planete=function(e,t){this.x=0,this.name=e.name,this.y=e.posY,this.z=0,this.size=e.size,this.sens=e.sens,this.amp=e.amp,this.speed=e.speed,this.index=t,this.asset_1=e.assetSimple};Planete.prototype.load=function(){var e=this;loader.load(e.asset_1,function(t){{var n=t.scene;t.skins[0]}n.position.set(e.x,e.y,e.z),n.scale.set(e.size,e.size,e.size),scene.add(n),e.mesh=n,e.mesh.instance=e,loaded=!0})},$(".test").on("click",function(){index=$(this).data("index"),zoomOnPlanet(index,130)}),$(".face").on("click",function(){replaceCamera(0,50,500)}),$(".reset").on("click",function(){$("#close").css("display","none"),$(".face").css("display","block"),center=scene.position,controls.enabled=!0,statutRot=!0,replaceCamera(0,50,4e3)}),init(),animate();