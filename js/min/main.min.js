function createSystem(){for(var e=0;e<planetesArray.length;e++){var n=new Planete(planetesArray[e]);planetes.push(n),n.load()}}function init(){scene=new THREE.Scene,scene.fog=new THREE.Fog(0,3500,15e3),scene.fog.color.setHSL(.51,.4,.01),renderer=new THREE.WebGLRenderer({alpha:!0,antialias:!0}),renderer.setSize(WIDTH,HEIGHT),container.appendChild(renderer.domElement),camera=new THREE.PerspectiveCamera(45,WIDTH/HEIGHT,1,1e4),camera.position.y=50,camera.position.z=1500,scene.add(camera);var e=new THREE.AmbientLight(16777215);e.color.setHSL(.56,.53,.19),scene.add(e);var n=new THREE.DirectionalLight(16777215,.125);n.position.set(0,-1,0).normalize(),scene.add(n),n.color.setHSL(.56,.53,.29),window.addEventListener("resize",function(){renderer.setSize(WIDTH,HEIGHT),camera.aspect=WIDTH/HEIGHT,camera.updateProjectionMatrix()}),textureFlare0=THREE.ImageUtils.loadTexture("../textures/lensflare0_alpha.png"),textureFlare2=THREE.ImageUtils.loadTexture("../textures/lensflare2.png"),textureFlare3=THREE.ImageUtils.loadTexture("../textures/lensflare3.png"),addLight(.55,.9,.5,5e3,0,-0),addLight(.08,.8,.5,0,0,-0),addLight(.995,.5,.9,5e3,0,-0),hemiLight=new THREE.HemisphereLight(16777215,16777215,.6),hemiLight.color.setHSL(.6,1,.6),hemiLight.groundColor.setHSL(.095,1,.75),hemiLight.position.set(0,1e3,40),scene.add(hemiLight),loader.options.convertUpAxis=!0,createSystem(),center=scene.position,controls=new THREE.FlyControls(camera,renderer.domElement),controls.movementSpeed=100,controls.domElement=container,controls.rollSpeed=.09,controls.autoForward=!1,controls.dragToLook=!1,renderer.setClearColor(scene.fog.color,1),renderer.gammaInput=!0,renderer.gammaOutput=!0,renderer.domElement.addEventListener("mousemove",onDocumentMouseMove,!1),renderer.domElement.addEventListener("mousedown",onDocumentMouseDown,!1),renderer.domElement.addEventListener("mouseup",onDocumentMouseUp,!1)}function addLight(e,n,t,o,a,r){var s=new THREE.PointLight(16777215,1.5,4500);s.color.setHSL(e,n,t),s.position.set(o,a,r),scene.add(s);var i=new THREE.Color(16777215);i.setHSL(e,n,t+.5);var l=new THREE.LensFlare(textureFlare0,700,0,THREE.AdditiveBlending,i);l.add(textureFlare2,512,0,THREE.AdditiveBlending),l.add(textureFlare2,512,0,THREE.AdditiveBlending),l.add(textureFlare2,512,0,THREE.AdditiveBlending),l.add(textureFlare3,60,.6,THREE.AdditiveBlending),l.add(textureFlare3,70,.7,THREE.AdditiveBlending),l.add(textureFlare3,120,.9,THREE.AdditiveBlending),l.add(textureFlare3,70,1,THREE.AdditiveBlending),l.customUpdateCallback=lensFlareUpdateCallback,l.position.copy(s.position),scene.add(l)}function lensFlareUpdateCallback(e){var n,t,o=e.lensFlares.length,a=2*-e.positionScreen.x,r=2*-e.positionScreen.y;for(n=0;o>n;n++)t=e.lensFlares[n],t.x=e.positionScreen.x+a*t.distance,t.y=e.positionScreen.y+r*t.distance,t.rotation=0;e.lensFlares[2].y+=.025,e.lensFlares[3].rotation=.5*e.positionScreen.x+THREE.Math.degToRad(45)}function animate(){requestAnimationFrame(animate),TWEEN.update(),render()}function render(){if(statutRot)for(var e=Date.now(),n=0;n<planetes.length;n++)planetes[n].mesh.position.x=Math.cos(e*planetes[n].speed*planetes[n].sens)*planetes[n].amp,planetes[n].mesh.position.z=Math.sin(e*planetes[n].speed*planetes[n].sens)*planetes[n].amp,planetes[n].mesh.rotation.y;for(var n=0;n<planetes.length;n++)planetes[n].mesh.rotation.y+=.01;var t=clock.getDelta();controls.update(t),statutRot||camera.lookAt(center),renderer.render(scene,camera)}function replaceCamera(e,n,t){new TWEEN.Tween(camera.position).to({x:e,y:n,z:t},1e3*Math.random()+1e3).easing(TWEEN.Easing.Exponential.InOut).start(),new TWEEN.Tween(camera.rotation).to({x:0,y:0,z:0},1e3*Math.random()+1e3).easing(TWEEN.Easing.Exponential.InOut).start(),new TWEEN.Tween(this).to({},2e3).onUpdate(render).start()}function zoomOnPlanet(e){pas=planetes[e].size+50,x=planetes[e].mesh.position.x+pas,y=planetes[e].mesh.position.y+pas,z=planetes[e].mesh.position.z+pas,$("#close").css("display","block"),replaceCamera(x,y,z),statutRot=!1,controls.enabled=!1}function onDocumentMouseMove(e){e.preventDefault(),mouse.x=e.clientX/window.innerWidth*2-1,mouse.y=2*-(e.clientY/window.innerHeight)+1}function onDocumentMouseDown(e){console.log("in"),e.preventDefault();var n=new THREE.Vector3(mouse.x,mouse.y,.5);n.unprojectVector(camera);var t=new THREE.Raycaster(camera.position,n.sub(camera.position).normalize()),o=t.intersectObjects(planetes);o.length>0&&alert("ok")}function onDocumentMouseUp(){console.log("out")}var scene,camera,renderer,bouton,index,center,textureFlare0,textureFlare1,textureFlare3,planetes=[],mouse=new THREE.Vector2,statutRot=!0,WIDTH=window.innerWidth,HEIGHT=window.innerHeight,container=document.getElementById("container"),clock=new THREE.Clock,loader=new THREE.ColladaLoader,Planete=function(e){this.x=e.posX,this.y=e.posY,this.z=e.posZ,this.size=e.size,this.sens=e.sens,this.amp=e.amp,this.speed=e.speed};Planete.prototype.load=function(){var e=this;loader.load("assets/planet.dae",function(n){{var t=n.scene;n.skins[0]}t.position.set(e.x,e.y,e.z),t.scale.set(e.size,e.size,e.size),scene.add(t),e.mesh=t})},$(".test").on("click",function(){index=$(this).data("index"),center=planetes[index].mesh.position,zoomOnPlanet(index)}),$("#close").on("click",function(){$("#close").css("display","none"),center=scene.position,controls.enabled=!0,statutRot=!0,replaceCamera(0,50,500)}),init(),animate();